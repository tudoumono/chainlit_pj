# Phase 3 動作確認チェックリスト

## Phase 3の概要
**データベース基盤構築**：SQLite3によるセッション管理とメッセージ履歴の永続化

## 新しく追加されたファイル
- `utils/session_handler.py` - データベース管理モジュール
- `app.py` - Phase 3版に更新（v0.3.0）

## 起動前の確認

### 1. 環境チェック
```bash
uv run python check_env.py
```

### 2. アプリケーション起動
```bash
uv run chainlit run app.py
```

## 機能テスト

### 1. 初期画面の確認
- [ ] Version: 0.3.0 (Phase 3) が表示される
- [ ] セッションIDが自動生成される
- [ ] データベース統計が表示される

### 2. データベース初期化の確認
- [ ] `chat_history.db`ファイルが作成される
- [ ] エラーなく起動する

### 3. セッション管理コマンド

#### `/sessions` - セッション一覧
- [ ] セッション一覧が表示される
- [ ] 現在のセッションに⭐マークが付く

#### `/clear` - 新しいセッション
- [ ] 新しいセッションが作成される
- [ ] 新しいセッションIDが表示される

#### `/rename [タイトル]` - セッションリネーム
- [ ] `/rename APIテスト` でタイトル変更
- [ ] `/sessions` で変更が反映される

#### `/stats` - データベース統計
- [ ] セッション数が表示される
- [ ] メッセージ総数が表示される
- [ ] データベースサイズが表示される

### 4. メッセージの永続化テスト
- [ ] メッセージを送信
- [ ] メッセージがデータベースに保存される
- [ ] メッセージカウントが増える

### 5. セッション切り替えテスト
1. 複数のセッションを作成
   - [ ] `/clear` で新セッション1
   - [ ] メッセージを送信
   - [ ] `/clear` で新セッション2
   - [ ] メッセージを送信

2. セッション一覧を確認
   - [ ] `/sessions` で複数のセッションが表示される

3. セッション切り替え
   - [ ] `/session [ID]` で切り替え
   - [ ] 過去のメッセージが表示される

### 6. アプリ再起動テスト
- [ ] アプリを停止（Ctrl+C）
- [ ] アプリを再起動
- [ ] `/sessions` で過去のセッションが表示される
- [ ] セッションに切り替えて履歴が残っている

## コマンド一覧（Phase 3追加分）

| コマンド | 説明 | 例 |
|---------|------|-----|
| `/sessions` | セッション一覧表示 | `/sessions` |
| `/session` | セッション切り替え | `/session abc123de` |
| `/rename` | セッションタイトル変更 | `/rename OpenAI テスト` |
| `/clear` | 新しいセッション開始 | `/clear` |
| `/stats` | データベース統計表示 | `/stats` |

## データベース確認

### SQLiteで直接確認（オプション）
```bash
# SQLite3コマンドラインツール
sqlite3 chat_history.db

# テーブル一覧
.tables

# セッション一覧
SELECT id, title, created_at FROM chat_sessions;

# メッセージ数確認
SELECT COUNT(*) FROM chat_messages;

# 終了
.quit
```

## トラブルシューティング

### データベースエラー
```bash
# データベースファイルを削除して再作成
rm chat_history.db
uv run chainlit run app.py
```

### セッションが表示されない
- ブラウザのキャッシュをクリア
- 新しいタブで開き直す

### ImportError: aiosqlite
```bash
# aiosqliteをインストール
uv pip install aiosqlite
```

## Phase 3 完了基準

以下がすべて確認できたら完了：
- ✅ データベースが作成される
- ✅ セッションが永続化される
- ✅ メッセージが保存される
- ✅ セッション一覧が表示される
- ✅ セッション切り替えができる
- ✅ アプリ再起動後も履歴が残る
- ✅ 統計情報が正しく表示される

## 追加された新機能まとめ

### データベース機能
- SQLite3による永続化
- 3つのテーブル（sessions, messages, personas）
- 自動インデックス作成

### セッション管理
- UUID4によるセッションID生成
- セッションごとのメッセージ保存
- セッション一覧と切り替え
- タイトル変更機能

### 統計機能
- セッション数カウント
- メッセージ総数
- データベースサイズ
- 最終更新日時

## 次のステップ

Phase 4（基本的なチャット機能）に進む：
- OpenAI Responses APIの実装
- ストリーミング応答
- 実際のAI応答機能