
# ベクトルストア管理に関する議論まとめ

## 3層の管理レイヤー
1. **会社全体 (層1)**
   - ユーザは作成しない
   - ID入力のみで利用可能
   - 現在この仕組みは実装済み

2. **個人ユーザー (層2)**
   - ユーザが作成する
   - `/vs` で作成するとチャット単位と重複するため、別画面で作成を制御する方針
   - ユーザがエンジニアとは限らないので、GUIベースで直感的な操作が望ましい
   - カスタムカテゴリで分類したい
   - 作成・削除だけでなく **更新（用途カテゴリや初期ファイル設定変更）** も可能にしたい

3. **チャット単位 (層3)**
   - ユーザは意識的に作成しない
   - チャットでファイルをアップロードした際に自動で生成される想定
   - ID入力不要で「有効/無効トグル」のみで制御可能

---

## 実装パターン検討
### パターンA: `/vs` コマンドで作成
- **メリット**
  - シンプルにコマンドベースで完結
  - 実装コストが低い
- **デメリット**
  - チャット単位の作成と混ざって混乱しやすい
  - エンジニア以外には不向き

### パターンB: GUI（Chainlitのカスタム要素＋サーバー連携）
- **メリット**
  - GUIで分かりやすく、非エンジニアも利用可能
  - 用途カテゴリや初期ファイルの選択UIを実装できる
  - 更新（カテゴリ変更・初期ファイル再設定）が可能
- **デメリット**
  - 実装コストがやや高い
  - 状態管理が必要

---

## 今後の課題: 他人のベクトルストア操作防止
- APIキーが同一プロジェクト発行のため、他人のベクトルストアも参照・変更・削除できてしまう懸念あり
- **対応策候補**
  - ベクトルストア作成時に `metadata` フィールドに「作成ユーザID」を付与し、一覧や更新時にフィルタリングする
  - Chainlit 側で認証済みユーザのIDをセッションに保持し、API呼び出し時に必ず付与
  - 他人が作ったベクトルストアはUIに表示しない／更新不可にする

---

## 結論
- **個人層 (層2) は GUI 管理がベスト** → Chainlit のカスタムUIで用途カテゴリ・初期ファイル選択・更新を含めた管理画面を実装  
- **セキュリティ上は metadata にユーザID を持たせてフィルタリングする実装が必要**

