# 多機能AIワークスペース - 段階的開発計画書

## 開発方針
- **Small Start, Quick Feedback**: 各フェーズで動作確認を行い、問題があれば修正してから次へ進む
- **Incremental Development**: 機能を少しずつ追加し、常に動作する状態を維持
- **Test-Driven**: 各機能の実装後は必ず動作テストを実施

---

## Phase 1: 基本環境構築とChainlit起動確認
**目標**: Chainlitアプリケーションが起動し、基本的な画面遷移ができることを確認

### 1.1 必要なファイル作成
- [ ] `requirements.txt` - 基本的な依存関係
- [ ] `.env.example` - 環境変数のテンプレート
- [ ] `app.py` - 最小限のウェルカム画面

### 1.2 実装内容
```python
# app.py - 最小構成
import chainlit as cl

@cl.on_chat_start
async def start():
    await cl.Message("Welcome to AI Workspace").send()
```

### 1.3 動作確認
- Chainlitが起動するか
- ウェルカムメッセージが表示されるか

---

## Phase 2: 設定管理機能
**目標**: APIキーの保存と読み込み、接続テストができる

### 2.1 必要なファイル
- [ ] `utils/config.py` - 設定管理モジュール
- [ ] `app.py` の更新 - 設定画面UI追加

### 2.2 実装内容
- `.env`ファイルの読み書き機能
- OpenAI APIキーの保存
- 接続テスト機能（簡単なAPI呼び出し）

### 2.3 動作確認
- APIキーの保存が`.env`に反映されるか
- 接続テストが成功/失敗を正しく判定するか

---

## Phase 3: データベース基盤構築
**目標**: SQLite3でセッション管理の基礎を作る

### 3.1 必要なファイル
- [ ] `utils/session_handler.py` - DB管理モジュール

### 3.2 実装内容
- SQLite3データベースの初期化
- テーブル作成（chat_sessions, chat_messages）
- 基本的なCRUD操作（Create, Read, Update, Delete）

### 3.3 動作確認
- データベースファイルが作成されるか
- セッション情報の保存と読み込みができるか

---

## Phase 4: 基本的なチャット機能（Responses API）
**目標**: OpenAI Responses APIを使った最小限のチャット機能を実装

### 4.1 必要なファイル
- [ ] `pages/1_Responses_API_Chat.py` - チャット画面
- [ ] `utils/response_handler.py` - API呼び出しロジック

### 4.2 実装内容
- テキストメッセージの送受信
- ストリーミング表示
- 基本的なエラーハンドリング

### 4.3 動作確認
- メッセージを送信してAIから応答が返ってくるか
- ストリーミングで文字が流れて表示されるか
- 会話履歴がUIに表示されるか

---

## Phase 5: セッション永続化
**目標**: チャット履歴をデータベースに保存し、再読み込みできるようにする

### 5.1 実装内容
- メッセージのDB保存
- セッション一覧の表示
- 過去のセッション再開機能
- タイトル自動生成

### 5.2 動作確認
- アプリを再起動しても会話履歴が残っているか
- 複数のセッションを切り替えられるか
- previous_response_idによる会話継続ができるか

---

## Phase 6: 高度な設定機能
**目標**: モデル選択、システムプロンプト、ペルソナ機能を追加

### 6.1 実装内容
- モデル選択ドロップダウン
- システムプロンプト入力欄
- ペルソナの保存と読み込み
- personas テーブルの実装

### 6.2 動作確認
- 異なるモデルで応答が変わるか
- システムプロンプトが効いているか
- ペルソナを切り替えられるか

---

## Phase 7: ベクトルストア基礎
**目標**: OpenAI Embeddingsを使った個人ナレッジベースの基本実装

### 7.1 必要なファイル
- [ ] `utils/vector_store_handler.py` - ベクトルストア管理

### 7.2 実装内容
- ファイルアップロード機能
- ベクトルストアの作成
- 個人VSのID管理
- file_searchツールの有効化

### 7.3 動作確認
- ファイルをアップロードしてVSが作成されるか
- アップロードした内容を基にAIが回答するか

---

## Phase 8: 3階層ベクトルストア
**目標**: 社内・個人・セッションの3階層VSを実装

### 8.1 実装内容
- 社内VS IDの設定（.env）
- セッション用VS（一時的）の実装
- VS選択チェックボックス
- 動的なtool_resources構築

### 8.2 動作確認
- 各VSを個別に有効/無効にできるか
- 複数のVSを組み合わせて検索できるか
- セッション終了時にセッションVSが削除されるか

---

## Phase 9: マルチモーダル入力
**目標**: 画像やファイルを含むプロンプトに対応

### 9.1 実装内容
- ファイルアップローダーUI
- 画像のBase64エンコード
- ファイルのOpenAIアップロード
- マルチパートプロンプトの構築

### 9.2 動作確認
- 画像を添付してAIが内容を認識するか
- PDFなどのファイルを処理できるか

---

## Phase 10: Agents SDK実装
**目標**: 2つ目のチャットエンジンを実装

### 10.1 必要なファイル
- [ ] `pages/2_Agents_SDK_Chat.py` - Agents版チャット画面
- [ ] `utils/agent_handler.py` - エージェントロジック

### 10.2 実装内容
- エージェントの定義
- thread_idによるセッション管理
- ツール呼び出しの可視化

### 10.3 動作確認
- Agents SDKでチャットができるか
- スレッドが永続化されるか
- ツール使用が表示されるか

---

## Phase 11: エクスポート機能
**目標**: チャット履歴を各種形式で出力

### 11.1 必要なファイル
- [ ] `utils/export_handler.py` - エクスポート処理

### 11.2 実装内容
- JSON形式エクスポート
- HTML形式エクスポート
- PDF形式エクスポート（オプション）

### 11.3 動作確認
- 各形式でファイルが生成されるか
- 内容が正しく出力されているか

---

## Phase 12: UI/UX改善と最終調整
**目標**: ユーザビリティの向上と全体的な品質向上

### 12.1 実装内容
- エラーメッセージの改善
- ローディング表示
- タグ機能の実装
- 検索機能
- ショートカットキー
- レスポンシブデザイン調整

### 12.2 動作確認
- 全機能の統合テスト
- パフォーマンステスト
- エッジケースのテスト

---

## テスト項目チェックリスト

### 基本機能テスト
- [ ] アプリケーションの起動
- [ ] APIキーの保存と読み込み
- [ ] 接続テストの成功/失敗
- [ ] 基本的なチャット機能
- [ ] メッセージの永続化
- [ ] セッションの切り替え

### 高度な機能テスト
- [ ] ベクトルストアの作成と削除
- [ ] 3階層VSの組み合わせ
- [ ] 画像アップロード
- [ ] ファイルアップロード
- [ ] Agents SDKの動作
- [ ] エクスポート機能

### エラーハンドリングテスト
- [ ] API接続エラー時の処理
- [ ] 無効なファイル形式の処理
- [ ] レート制限への対応
- [ ] データベースエラーの処理

---

## 開発のポイント

1. **各フェーズで必ず動作確認を行う**
   - 動かないまま次に進まない
   - 問題があれば立ち止まって解決する

2. **ログ出力を活用する**
   - デバッグ時は詳細なログを出力
   - エラー時の状況を記録

3. **段階的に複雑性を増す**
   - 最初は最小限の機能から
   - 動作確認後に機能を追加

4. **ドキュメントを更新する**
   - 実装した内容を記録
   - 問題と解決策をメモ

5. **テストデータを用意する**
   - サンプルテキスト
   - テスト用画像
   - サンプルPDF

---

## 次のステップ

**Phase 1から順番に実装を開始します。**

まずは以下のコマンドで環境を準備：
```bash
# 仮想環境の作成
python -m venv venv

# 仮想環境の有効化（Windows）
venv\Scripts\activate

# 仮想環境の有効化（Mac/Linux）
source venv/bin/activate

# 基本パッケージのインストール
pip install chainlit openai python-dotenv
```

準備ができたら、Phase 1の`requirements.txt`と`app.py`の作成から始めましょう。