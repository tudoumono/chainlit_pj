# Chainlitå±¥æ­´ä¿å­˜ä¿®æ­£ã‚¬ã‚¤ãƒ‰

## å•é¡Œã®åŸå› 
ãƒ­ã‚°ã¨ã‚³ãƒ¼ãƒ‰ã®åˆ†æã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®å•é¡ŒãŒåˆ¤æ˜ã—ã¾ã—ãŸï¼š
- âœ… `create_step`ã¯å‘¼ã°ã‚Œã¦ãŠã‚Šã€ã‚¹ãƒ†ãƒƒãƒ—ã¯ä¿å­˜ã•ã‚Œã¦ã„ã‚‹
- âŒ `create_thread`ãŒä¸€åº¦ã‚‚å‘¼ã°ã‚Œã¦ã„ãªã„
- âŒ ãã®ãŸã‚`list_threads`ã§å¸¸ã«ã€Œã‚¹ãƒ¬ãƒƒãƒ‰ç·æ•°: 0ã€ã¨ãªã‚‹

**æ ¹æœ¬åŸå› ï¼š** app.pyã§ã‚¹ãƒ¬ãƒƒãƒ‰ï¼ˆThreadï¼‰ã‚’æ˜ç¤ºçš„ã«ä½œæˆã—ã¦ã„ãªã„ã“ã¨

## ä¿®æ­£å†…å®¹

### 1. å¿…è¦ãªã‚¤ãƒ³ãƒãƒ¼ãƒˆã®è¿½åŠ 
```python
import uuid  # ã‚¹ãƒ¬ãƒƒãƒ‰IDç”Ÿæˆç”¨
import chainlit.data as cl_data  # ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¢ã‚¯ã‚»ã‚¹ç”¨
```

### 2. on_chat_starté–¢æ•°ã®ä¿®æ­£
æ–°ã—ã„ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã«ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½œæˆï¼š
```python
@cl.on_chat_start
async def on_chat_start():
    # ... æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ ...
    
    # æ–°ã—ã„ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½œæˆï¼ˆå±¥æ­´ä¿å­˜ã®ãŸã‚å¿…é ˆï¼‰
    thread_id = str(uuid.uuid4())
    thread = ThreadDict(
        id=thread_id,
        name=f"Chat {datetime.now().strftime('%Y-%m-%d %H:%M')}",
        userId=current_user.identifier if current_user else "anonymous",
        user_identifier=current_user.identifier if current_user else "anonymous",
        tags=[],
        metadata={},
        createdAt=datetime.now().isoformat()
    )
    
    # ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½œæˆ
    if hasattr(cl_data, '_data_layer') and cl_data._data_layer:
        try:
            await cl_data._data_layer.create_thread(thread)
            print(f"âœ… æ–°ã—ã„ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½œæˆã—ã¾ã—ãŸ: {thread_id}")
        except Exception as e:
            print(f"âš ï¸ ã‚¹ãƒ¬ãƒƒãƒ‰ä½œæˆã‚¨ãƒ©ãƒ¼: {e}")
    
    # ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ã‚¹ãƒ¬ãƒƒãƒ‰IDã‚’ä¿å­˜
    cl.user_session.set("thread_id", thread_id)
```

### 3. start_new_chaté–¢æ•°ã®ä¿®æ­£
æ–°ã—ã„ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹ã™ã‚‹éš›ã«ã‚‚åŒæ§˜ã«ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½œæˆ

## ç¢ºèªæ–¹æ³•

### 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†èµ·å‹•
```bash
# Ctrl+C ã§ç¾åœ¨ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢å¾Œ
chainlit run app.py --headless
```

### 2. ãƒãƒ£ãƒƒãƒˆã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
é€šå¸¸é€šã‚Šãƒãƒ£ãƒƒãƒˆã‚’è¡Œã„ã€è¤‡æ•°ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚„ã‚Šå–ã‚Šã—ã¾ã™ã€‚

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç¢ºèª
```bash
python check_threads.py
```

### 4. æœŸå¾…ã•ã‚Œã‚‹çµæœ
- `create_thread`ãŒãƒ­ã‚°ã«è¡¨ç¤ºã•ã‚Œã‚‹
- `list_threads`ã§å®Ÿéš›ã®ã‚¹ãƒ¬ãƒƒãƒ‰æ•°ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- å·¦ä¸Šã®å±¥æ­´ãƒœã‚¿ãƒ³ã‹ã‚‰éå»ã®ä¼šè©±ãŒç¢ºèªã§ãã‚‹

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹å ´åˆ
```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
rm .chainlit/chainlit.db

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†èµ·å‹•
chainlit run app.py --headless
```

### ãƒ­ã‚°ã§ç¢ºèªã™ã¹ãå†…å®¹
æˆåŠŸæ™‚ã®ãƒ­ã‚°ä¾‹ï¼š
```
ğŸ”§ SQLite: create_threadãŒå‘¼ã°ã‚Œã¾ã—ãŸ - ID: xxxxx
   âœ… ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’SQLiteã«ä¿å­˜ã—ã¾ã—ãŸ
ğŸ”§ SQLite: list_threadsãŒå‘¼ã°ã‚Œã¾ã—ãŸ
   ã‚¹ãƒ¬ãƒƒãƒ‰ç·æ•°: 1
   å–å¾—ã—ãŸã‚¹ãƒ¬ãƒƒãƒ‰æ•°: 1
```

## ã¾ã¨ã‚
ã“ã®ä¿®æ­£ã«ã‚ˆã‚Šã€Chainlitã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§å±¥æ­´ãŒæ­£ã—ãä¿å­˜ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
ã‚¹ãƒ¬ãƒƒãƒ‰ã¨ã‚¹ãƒ†ãƒƒãƒ—ã®ä¸¡æ–¹ãŒé©åˆ‡ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã•ã‚Œã€
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†èµ·å‹•ã—ã¦ã‚‚å±¥æ­´ãŒæ°¸ç¶šçš„ã«ä¿æŒã•ã‚Œã¾ã™ã€‚
